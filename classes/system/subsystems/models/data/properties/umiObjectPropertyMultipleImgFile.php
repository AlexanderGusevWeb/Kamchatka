<?php
 use UmiCms\Service;class umiObjectPropertyMultipleImgFile extends umiObjectProperty {const TABLE_NAME = 'cms3_object_images';protected function getTableName() {return self::TABLE_NAME;}protected function loadValue() {$result = [];$v945100186b119048837b9859c2c46410 = (int) $this->field_id;$v16b2b26000987faccb260b9d39df1269 = (int) $this->object_id;$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v80071f37861c360a27b7327e132c911a = $this->getTableName();$vef5714e0519bfaa645cdff7d28843b70 = <<<SQL
	SELECT `id`, `src`, `alt`, `ord`
	FROM `$v80071f37861c360a27b7327e132c911a`
	WHERE `obj_id` = $v16b2b26000987faccb260b9d39df1269 AND `field_id` = $v945100186b119048837b9859c2c46410
	ORDER BY `ord`;
SQL;   $v0ed50ea17be70d18270742fa3d77b17e = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vef5714e0519bfaa645cdff7d28843b70);$v0ed50ea17be70d18270742fa3d77b17e->setFetchType(IQueryResult::FETCH_ASSOC);if ($v0ed50ea17be70d18270742fa3d77b17e->length() == 0) {return $result;}$v9eb34ba60945c28231943f199eb4aacc = Service::Request()->isAdmin();foreach ($v0ed50ea17be70d18270742fa3d77b17e as $vf1965a857bc285d26fe22023aa5ab50d) {$v25d902c24283ab8cfbac54dfa101ad31 = self::unescapeFilePath($vf1965a857bc285d26fe22023aa5ab50d['src']);$v78805a221a988e79ef3f42d7c5bfd418 = new umiImageFile($v25d902c24283ab8cfbac54dfa101ad31);$v78805a221a988e79ef3f42d7c5bfd418->setAlt($vf1965a857bc285d26fe22023aa5ab50d['alt']);$v78805a221a988e79ef3f42d7c5bfd418->setOrder($vf1965a857bc285d26fe22023aa5ab50d['ord']);$v78805a221a988e79ef3f42d7c5bfd418->setId($vf1965a857bc285d26fe22023aa5ab50d['id']);if ($v78805a221a988e79ef3f42d7c5bfd418->getIsBroken() && !$v9eb34ba60945c28231943f199eb4aacc) {continue;}$result[$v78805a221a988e79ef3f42d7c5bfd418->getFilePath()] = $v78805a221a988e79ef3f42d7c5bfd418;}return $result;}protected function saveValue() {$this->deleteCurrentRows();if (!is_array($this->value)) {return;}$v945100186b119048837b9859c2c46410 = (int) $this->field_id;$v16b2b26000987faccb260b9d39df1269 = (int) $this->object_id;$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v80071f37861c360a27b7327e132c911a = $this->getTableName();foreach ($this->value as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if (!$v2063c1608d6e0baf80249c42e2be5804 instanceof iUmiImageFile || $v2063c1608d6e0baf80249c42e2be5804->getIsBroken()) {continue;}$v25d902c24283ab8cfbac54dfa101ad31 = $v4717d53ebfdfea8477f780ec66151dcb->escape($v2063c1608d6e0baf80249c42e2be5804->getFilePath());$v34823136d0dd91d0f5d22db740f7679c = $v4717d53ebfdfea8477f780ec66151dcb->escape($v2063c1608d6e0baf80249c42e2be5804->getAlt());$v8bef1cc20ada3bef55fdf132cb2a1cb9 = (int) $v2063c1608d6e0baf80249c42e2be5804->getOrder();if ($v8bef1cc20ada3bef55fdf132cb2a1cb9 === 0) {$v8bef1cc20ada3bef55fdf132cb2a1cb9 = $this->getMaxOrder() + 1;}$ve0e39b991692259764469b25bfe10b47 = <<<SQL
	INSERT INTO `$v80071f37861c360a27b7327e132c911a` (`obj_id`, `field_id`, `src`, `alt`, `ord`)
	VALUES ($v16b2b26000987faccb260b9d39df1269, $v945100186b119048837b9859c2c46410, '$v25d902c24283ab8cfbac54dfa101ad31', '$v34823136d0dd91d0f5d22db740f7679c', $v8bef1cc20ada3bef55fdf132cb2a1cb9)
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($ve0e39b991692259764469b25bfe10b47);}}protected function isNeedToSave(array $v7f7cfde5ec586119b48911a2c75851e5) {$v6f0d192417e46eb424a7f99546f2fbda = $this->value;if (umiCount($v7f7cfde5ec586119b48911a2c75851e5) !== umiCount($v6f0d192417e46eb424a7f99546f2fbda)) {return true;}$vbc18a572fc42bfa0b5ac7af477a6d076 = [];foreach ($v6f0d192417e46eb424a7f99546f2fbda as $v0382b9fd9ef50b6a335f35e0aaaebf99) {$vbc18a572fc42bfa0b5ac7af477a6d076[$v0382b9fd9ef50b6a335f35e0aaaebf99->getFilePath()] = $v0382b9fd9ef50b6a335f35e0aaaebf99;}foreach ($v7f7cfde5ec586119b48911a2c75851e5 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if (!$v2063c1608d6e0baf80249c42e2be5804 instanceof iUmiImageFile) {continue;}switch (true) {case isset($vbc18a572fc42bfa0b5ac7af477a6d076[$v2063c1608d6e0baf80249c42e2be5804->getFilePath()]): {$v0382b9fd9ef50b6a335f35e0aaaebf99 = $vbc18a572fc42bfa0b5ac7af477a6d076[$v2063c1608d6e0baf80249c42e2be5804->getFilePath()];break;}default: {return true;}}if ($v2063c1608d6e0baf80249c42e2be5804->getFilePath() !== $v0382b9fd9ef50b6a335f35e0aaaebf99->getFilePath()) {return true;}if ($v2063c1608d6e0baf80249c42e2be5804->getAlt() !== $v0382b9fd9ef50b6a335f35e0aaaebf99->getAlt()) {return true;}if ($v2063c1608d6e0baf80249c42e2be5804->getOrder() !== $v0382b9fd9ef50b6a335f35e0aaaebf99->getOrder()) {return true;}}return false;}public function getMaxOrder() {$v16b2b26000987faccb260b9d39df1269 = (int) $this->object_id;$v945100186b119048837b9859c2c46410 = (int) $this->field_id;$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v80071f37861c360a27b7327e132c911a = $this->getTableName();$vef5714e0519bfaa645cdff7d28843b70 = <<<SQL
	SELECT max(`ord`) as ord FROM `$v80071f37861c360a27b7327e132c911a` WHERE `obj_id` = $v16b2b26000987faccb260b9d39df1269 AND `field_id` = $v945100186b119048837b9859c2c46410;
SQL;   $result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vef5714e0519bfaa645cdff7d28843b70);$result->setFetchType(IQueryResult::FETCH_ASSOC);$result = $result->getIterator();$vf1965a857bc285d26fe22023aa5ab50d = $result->current();return (int) $vf1965a857bc285d26fe22023aa5ab50d['ord'];}}