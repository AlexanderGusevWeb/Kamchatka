<?php
 use \UmiCms\Service;class systemInfo extends singleton {private $registry;private $resource;const SYSTEM     = 1;const PHP        = 2;const DATABASE   = 4;const NETWORK   =  8;const STAT       = 16;const MODULES    = 32;const LICENSE    = 64;public static function getInstance($v4a8a08f09d37b73795649038408b5f33 = NULL) {return parent::getInstance(__CLASS__);}protected function __construct() {$this->registry = Service::Registry();$v96ab4e163f4ee03aaa4d1051aa51d204 = $this->getConnection();if ($v96ab4e163f4ee03aaa4d1051aa51d204 === null) {throw new coreException(__METHOD__ . ': can\' connect to data base');}$this->resource = $v96ab4e163f4ee03aaa4d1051aa51d204;}public function getInfo($vef3e30e070f70244fd6578d88a6b77ac = 1) {if (!is_numeric($vef3e30e070f70244fd6578d88a6b77ac)) {throw new coreException(__METHOD__ . ': incorrect option given');}$vc68271a63ddbc431c307beb7d2918275 = [];if (($vef3e30e070f70244fd6578d88a6b77ac & self::SYSTEM) === self::SYSTEM) {$vc68271a63ddbc431c307beb7d2918275['system'] = $this->getSystemInfo();}if (($vef3e30e070f70244fd6578d88a6b77ac & self::PHP) === self::PHP) {$vc68271a63ddbc431c307beb7d2918275['php'] = $this->getPHPInfo();}if (($vef3e30e070f70244fd6578d88a6b77ac & self::DATABASE) === self::DATABASE) {$vc68271a63ddbc431c307beb7d2918275['database'] = $this->getDataBaseInfo();}if (($vef3e30e070f70244fd6578d88a6b77ac & self::NETWORK) === self::NETWORK) {$vc68271a63ddbc431c307beb7d2918275['network'] = $this->getNetworkInfo();}if (($vef3e30e070f70244fd6578d88a6b77ac & self::STAT) === self::STAT) {$vc68271a63ddbc431c307beb7d2918275['stat'] = $this->getStatInfo();}if (($vef3e30e070f70244fd6578d88a6b77ac & self::MODULES) === self::MODULES) {$vc68271a63ddbc431c307beb7d2918275['modules'] = $this->getModulesInfo();}if (($vef3e30e070f70244fd6578d88a6b77ac & self::LICENSE) === self::LICENSE) {$vc68271a63ddbc431c307beb7d2918275['license'] = $this->getLicenseInfo();}return $vc68271a63ddbc431c307beb7d2918275;}private function getSystemInfo() {return [    'version' => $this->registry->get('//modules/autoupdate/system_version'),    'revision' => $this->registry->get('//modules/autoupdate/system_build'),    'license' => $this->registry->get('//modules/autoupdate/system_edition'),   ];}private function getPHPInfo() {return [    'version' => $this->parseVersion(phpversion()),    'os' => php_uname(),    'info' => [     'modules' => get_loaded_extensions(),     'configurations' => ini_get_all()    ]   ];}private function getDataBaseInfo() {return [    'driver' => iConfiguration::MYSQL_DB_DRIVER,    'version' => $this->getMySQLVersion()   ];}private function getNetworkInfo() {return [    'hosts' => $this->getHosts(),    'ip' =>  getServer('SERVER_ADDR')   ];}private function getStatInfo() {return [    'last_update_time' => $this->registry->get('//modules/autoupdate/last_updated'),    'trial_days_left' => $this->registry->getDaysLeft(),    'web_server_id' => getServer('SERVER_SOFTWARE')   ];}private function getModulesInfo() {$v0eb9b3af2e4a00837a1b1a854c9ea18c = $this->registry->getList('//modules');$v50aff8b6672ee3b4f2abfc59a24bed89 = [];foreach ($v0eb9b3af2e4a00837a1b1a854c9ea18c as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {if (isset($v2063c1608d6e0baf80249c42e2be5804[0])) {$v50aff8b6672ee3b4f2abfc59a24bed89[] = $v2063c1608d6e0baf80249c42e2be5804[0];}}return $v50aff8b6672ee3b4f2abfc59a24bed89;}private function getLicenseInfo() {return [    'key' => $this->registry->get('//settings/keycode')   ];}private function parseVersion($v2af72f100c356273d46284f6fd1dfc08) {preg_match('/[0-9]+\.[0-9]+\.[0-9]+/', $v2af72f100c356273d46284f6fd1dfc08, $v9c28d32df234037773be184dbdafc274);if (!isset($v9c28d32df234037773be184dbdafc274[0])) {throw new coreException(__METHOD__ . ': can\' grab version');}return $v9c28d32df234037773be184dbdafc274[0];}private function getConnection() {if ($this->resource !== null) {return $this->resource;}$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$v4717d53ebfdfea8477f780ec66151dcb->open();$vcaf9b6b99962bf5c2264824231d7a40c = $v4717d53ebfdfea8477f780ec66151dcb->getConnectionInfo();return isset($vcaf9b6b99962bf5c2264824231d7a40c['link']) ? $vcaf9b6b99962bf5c2264824231d7a40c['link'] : null;}private function getMySQLVersion() {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vd678d131d7b67cbd13546948c491bb42 = $v4717d53ebfdfea8477f780ec66151dcb->getServerInfo();return $this->parseVersion($vd678d131d7b67cbd13546948c491bb42);}private function getHosts() {$ve4e46deb7f9cc58c7abfb32e5570b6f3 = Service::DomainCollection()    ->getList();$v85cf4e6d42a71e693fd780c8b29accdd = [];foreach ($ve4e46deb7f9cc58c7abfb32e5570b6f3 as $vad5f82e879a9c5d6b5b442eb37e50551) {$v85cf4e6d42a71e693fd780c8b29accdd[$vad5f82e879a9c5d6b5b442eb37e50551->getId()]['host'] = $vad5f82e879a9c5d6b5b442eb37e50551->getHost();$v2768190d8afc54be5dac0c87efe836e3 = $vad5f82e879a9c5d6b5b442eb37e50551->getMirrorsList();foreach ($v2768190d8afc54be5dac0c87efe836e3 as $vfbe322a89bc0ba531c3f0050e3935f28) {$v85cf4e6d42a71e693fd780c8b29accdd[$vad5f82e879a9c5d6b5b442eb37e50551->getId()]['mirrors'][] = $vfbe322a89bc0ba531c3f0050e3935f28->getHost();}if ($vad5f82e879a9c5d6b5b442eb37e50551->getIsDefault()) {$v85cf4e6d42a71e693fd780c8b29accdd[$vad5f82e879a9c5d6b5b442eb37e50551->getId()]['is_default'] = '1';}}return $v85cf4e6d42a71e693fd780c8b29accdd;}}