<?php
 use UmiCms\Service;class MailTemplate implements  iUmiCollectionItem,  iUmiDataBaseInjector,  iUmiConstantMapInjector,  iClassConfigManager {use tUmiDataBaseInjector;use tCommonCollectionItem;use tUmiConstantMapInjector;use tClassConfigManager;const FIELD_WRAPPER_SYMBOL = '%';private $notificationId;private $name;private $type;private $content;private static $classConfig = [   'fields' => [    [     'name' => 'ID_FIELD_NAME',     'required' => true,     'unchangeable' => true,     'setter' => 'setId',     'getter' => 'getId'    ],    [     'name' => 'NOTIFICATION_ID_FIELD_NAME',     'required' => true,     'setter' => 'setNotificationId',     'getter' => 'getNotificationId'    ],    [     'name' => 'NAME_FIELD_NAME',     'required' => true,     'setter' => 'setName',     'getter' => 'getName'    ],    [     'name' => 'TYPE_FIELD_NAME',     'required' => true,     'setter' => 'setType',     'getter' => 'getType'    ],    [     'name' => 'CONTENT_FIELD_NAME',     'required' => true,     'setter' => 'setContent',     'getter' => 'getContent'    ]   ]  ];public function getNotificationId() {return $this->notificationId;}public function setNotificationId($vb80bb7740288fda1f201890375a60c8f) {$this->setDifferentValue('notificationId', $vb80bb7740288fda1f201890375a60c8f, 'int');}public function getName() {return $this->name;}public function setName($vb068931cc450442b63f5b3d276ea4297) {$this->setDifferentValue('name', $vb068931cc450442b63f5b3d276ea4297, 'string');}public function getType() {return $this->type;}public function setType($v599dcce2998a6b40b1e38e8c6006cb0a) {$this->setDifferentValue('type', $v599dcce2998a6b40b1e38e8c6006cb0a, 'string');}public function getContent() {return $this->content;}public function setContent($v9a0364b9e99bb480dd25e1f0284c8555) {$this->setDifferentValue('content', $v9a0364b9e99bb480dd25e1f0284c8555, 'string');}public function getModule() {return $this->getNotification()->getModule();}public function getNotification() {$va03acd8943baebf6a00aeb6792340e18 = Service::MailNotifications();$v1d78dc8ed51214e518b5114fe24490ae = $va03acd8943baebf6a00aeb6792340e18->getMap();$result = $va03acd8943baebf6a00aeb6792340e18->get([    $v1d78dc8ed51214e518b5114fe24490ae->get('ID_FIELD_NAME') => $this->getNotificationId()   ]);if (umiCount($result) > 0) {return array_shift($result);}}public function commit() {if (!$this->isUpdated()) {return false;}$v1d78dc8ed51214e518b5114fe24490ae = $this->getMap();$v4717d53ebfdfea8477f780ec66151dcb = $this->getConnection();$v80071f37861c360a27b7327e132c911a = $v4717d53ebfdfea8477f780ec66151dcb->escape($v1d78dc8ed51214e518b5114fe24490ae->get('TABLE_NAME'));$vbb1df230a5150b8ac17121321b3b514c = $v4717d53ebfdfea8477f780ec66151dcb->escape($v1d78dc8ed51214e518b5114fe24490ae->get('ID_FIELD_NAME'));$v4a7c4f6ee82fce4661351b7b688db9c4 = $v4717d53ebfdfea8477f780ec66151dcb->escape($v1d78dc8ed51214e518b5114fe24490ae->get('NOTIFICATION_ID_FIELD_NAME'));$v83ea2c7be983b2f78a3ee8cfa6556bbc = $v4717d53ebfdfea8477f780ec66151dcb->escape($v1d78dc8ed51214e518b5114fe24490ae->get('NAME_FIELD_NAME'));$vce6ba6b4afd61be6d0f21f1e2a995213 = $v4717d53ebfdfea8477f780ec66151dcb->escape($v1d78dc8ed51214e518b5114fe24490ae->get('TYPE_FIELD_NAME'));$v5180805afcdc53d067cf7c6b96c68c9d = $v4717d53ebfdfea8477f780ec66151dcb->escape($v1d78dc8ed51214e518b5114fe24490ae->get('CONTENT_FIELD_NAME'));$vb80bb7740288fda1f201890375a60c8f = $this->getId();$v76690295a4352fcca9cc1524cad83d1b = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->getNotificationId());$v599dcce2998a6b40b1e38e8c6006cb0a = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->getType());$vb068931cc450442b63f5b3d276ea4297 = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->getName());$v9a0364b9e99bb480dd25e1f0284c8555 = $v4717d53ebfdfea8477f780ec66151dcb->escape($this->getContent());$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
UPDATE `$v80071f37861c360a27b7327e132c911a`
	SET `$v4a7c4f6ee82fce4661351b7b688db9c4` = '$v76690295a4352fcca9cc1524cad83d1b', `$v83ea2c7be983b2f78a3ee8cfa6556bbc` = '$vb068931cc450442b63f5b3d276ea4297', 
		`$vce6ba6b4afd61be6d0f21f1e2a995213` = '$v599dcce2998a6b40b1e38e8c6006cb0a', `$v5180805afcdc53d067cf7c6b96c68c9d` = '$v9a0364b9e99bb480dd25e1f0284c8555'
		WHERE `$vbb1df230a5150b8ac17121321b3b514c` = $vb80bb7740288fda1f201890375a60c8f;
SQL;   $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);return true;}public function getProcessedContent(array $v21ffce5b8a6cc8cc6a41448dd69623c9 = []) {$v21ffce5b8a6cc8cc6a41448dd69623c9 = $this->stripSpecialCharacters($v21ffce5b8a6cc8cc6a41448dd69623c9);$vbd5ba09b13f5a1efbeb9791e5fb3ca8e = array_filter($v21ffce5b8a6cc8cc6a41448dd69623c9, function ($veca07335a33c5aeb5e1bc7c98b4b9d80) {return !is_array($veca07335a33c5aeb5e1bc7c98b4b9d80);});$vaba6fe61631d2971fd864efbf9b4a46b = array_filter($v21ffce5b8a6cc8cc6a41448dd69623c9, function ($veca07335a33c5aeb5e1bc7c98b4b9d80) {return is_array($veca07335a33c5aeb5e1bc7c98b4b9d80);});$v9a0364b9e99bb480dd25e1f0284c8555 = $this->parseTopLevelContent($vbd5ba09b13f5a1efbeb9791e5fb3ca8e);return $this->parseRecursiveContent($v9a0364b9e99bb480dd25e1f0284c8555, $vaba6fe61631d2971fd864efbf9b4a46b);}protected function stripSpecialCharacters($v21ffce5b8a6cc8cc6a41448dd69623c9) {if (!is_array($v21ffce5b8a6cc8cc6a41448dd69623c9)) {return $v21ffce5b8a6cc8cc6a41448dd69623c9;}$vd05b6ed7d2345020440df396d6da7f73 = array_keys($v21ffce5b8a6cc8cc6a41448dd69623c9);$v6b3afbe00a47b8b39ea691b01a449e32 = '/^\W*(\w+)\W*$/';foreach ($vd05b6ed7d2345020440df396d6da7f73 as $v06e3d36fa30cea095545139854ad1fb9) {$v2063c1608d6e0baf80249c42e2be5804 = $v21ffce5b8a6cc8cc6a41448dd69623c9[$v06e3d36fa30cea095545139854ad1fb9];unset($v21ffce5b8a6cc8cc6a41448dd69623c9[$v06e3d36fa30cea095545139854ad1fb9]);$v06e3d36fa30cea095545139854ad1fb9 = preg_replace($v6b3afbe00a47b8b39ea691b01a449e32, '$1', $v06e3d36fa30cea095545139854ad1fb9);$v21ffce5b8a6cc8cc6a41448dd69623c9[$v06e3d36fa30cea095545139854ad1fb9] = $this->stripSpecialCharacters($v2063c1608d6e0baf80249c42e2be5804);}return $v21ffce5b8a6cc8cc6a41448dd69623c9;}protected function parseTopLevelContent(array $v21ffce5b8a6cc8cc6a41448dd69623c9) {$vd05b6ed7d2345020440df396d6da7f73 = array_keys($v21ffce5b8a6cc8cc6a41448dd69623c9);$vf09cc7ee3a9a93273f4b80601cafb00c = array_values($v21ffce5b8a6cc8cc6a41448dd69623c9);$vd0e0c3ab351b07a793d3d05c399aca8a = array_map(function ($v2063c1608d6e0baf80249c42e2be5804) {return self::FIELD_WRAPPER_SYMBOL . $v2063c1608d6e0baf80249c42e2be5804 . self::FIELD_WRAPPER_SYMBOL;}, $vd05b6ed7d2345020440df396d6da7f73);return str_replace($vd0e0c3ab351b07a793d3d05c399aca8a, $vf09cc7ee3a9a93273f4b80601cafb00c, $this->getContent());}protected function parseRecursiveContent($v9a0364b9e99bb480dd25e1f0284c8555, array $v21ffce5b8a6cc8cc6a41448dd69623c9) {$ve6f502f7d88de75db45325d22998cf6d = Service::MailTemplates();$v2a0c47d4af5a6e909fa13fb19e7fc160 = '/%parse\.([^%]+)%/';while (preg_match($v2a0c47d4af5a6e909fa13fb19e7fc160, $v9a0364b9e99bb480dd25e1f0284c8555, $v9c28d32df234037773be184dbdafc274, PREG_OFFSET_CAPTURE)) {$vea2b2676c28c0db26d39331a336c6b92 = $v9c28d32df234037773be184dbdafc274[0][1];$v2fa47f7c65fec19cc163b195725e3844 = mb_strlen($v9c28d32df234037773be184dbdafc274[0][0]);$vb45cffe084dd3d20d928bee85e7b0f21 = $v9c28d32df234037773be184dbdafc274[1][0];list($v918d83c715c19dd93ff49f87e2fae0b3, $veca07335a33c5aeb5e1bc7c98b4b9d80) = explode('.', $vb45cffe084dd3d20d928bee85e7b0f21);$v66f6181bcb4cff4cd38fbc804a036db6 = $ve6f502f7d88de75db45325d22998cf6d->getByName($v918d83c715c19dd93ff49f87e2fae0b3);$vf5300127f646a4550bc4a04fbe393e79 = $this->parseTemplateList($v66f6181bcb4cff4cd38fbc804a036db6, $v21ffce5b8a6cc8cc6a41448dd69623c9[$veca07335a33c5aeb5e1bc7c98b4b9d80]);$v9a0364b9e99bb480dd25e1f0284c8555 = substr_replace($v9a0364b9e99bb480dd25e1f0284c8555, $vf5300127f646a4550bc4a04fbe393e79, $vea2b2676c28c0db26d39331a336c6b92, $v2fa47f7c65fec19cc163b195725e3844);}return $v9a0364b9e99bb480dd25e1f0284c8555;}protected function parseTemplateList($v66f6181bcb4cff4cd38fbc804a036db6, array $vd2cf103077b0cd5467ba560e0c2ac41a) {if (!$v66f6181bcb4cff4cd38fbc804a036db6 instanceof MailTemplate) {return '';}$v9a0364b9e99bb480dd25e1f0284c8555 = [];foreach ($vd2cf103077b0cd5467ba560e0c2ac41a as $v21ffce5b8a6cc8cc6a41448dd69623c9) {$v9a0364b9e99bb480dd25e1f0284c8555[] = $v66f6181bcb4cff4cd38fbc804a036db6->getProcessedContent($v21ffce5b8a6cc8cc6a41448dd69623c9);}return implode("\n", $v9a0364b9e99bb480dd25e1f0284c8555);}}