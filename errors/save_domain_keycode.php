<?php
 require_once '../libs/config.php';use UmiCms\Service;$va9205dcfd4a6f7c2cbe8be01566ff84a = Service::Registry();if ($va9205dcfd4a6f7c2cbe8be01566ff84a->checkSelfKeycode()) {exit();}if (is_file(SYS_TEMP_PATH . '/runtime-cache/registry')) {unlink(SYS_TEMP_PATH . '/runtime-cache/registry');}if (is_file(SYS_TEMP_PATH . '/runtime-cache/trash')) {unlink(SYS_TEMP_PATH . '/runtime-cache/trash');}$v957b527bcfbad2e80f58d20683931435 = isset($_SERVER['SERVER_ADDR']) ? $_SERVER['SERVER_ADDR'] : str_replace("\\", '', $_SERVER['DOCUMENT_ROOT']);$vad5f82e879a9c5d6b5b442eb37e50551 = getServer('HTTP_HOST');$v1a54c1036ccb10069e9c06281d52007a = getRequest('keycode');$vd4579b2688d675235f402f6b4b43bcbf = getRequest('do');$vebcb36c005e769a1576aa2a8d49539ec = getRequest('domain_keycode');$v18415cf46dd0e74b620c558a691ce8ff = getRequest('license_codename');if ($vd4579b2688d675235f402f6b4b43bcbf == 'load') {header('Content-type: text/xml; charset=utf-8');$v572d4e421e5e6b9bc11d815e8a027112 = 'aHR0cDovL2luc3RhbGwudW1pLWNtcy5ydS9maWxlcy90ZXN0aG9zdC5waHA=';$result = umiRemoteFileGetter::get(base64_decode($v572d4e421e5e6b9bc11d815e8a027112), dirname(__FILE__) . '/testhost.php');$v9a0364b9e99bb480dd25e1f0284c8555 = '<?xml version="1.0" encoding="utf-8"?>';if ($result->getSize() == 0) {$v9a0364b9e99bb480dd25e1f0284c8555 .= '<result><error>Не удается загрузить тесты хостинга.</error></result>';}else {$v9a0364b9e99bb480dd25e1f0284c8555 .= '<result>ok</result>';}echo $v9a0364b9e99bb480dd25e1f0284c8555;exit();}if ($vd4579b2688d675235f402f6b4b43bcbf == 'test') {header('Content-type: text/xml; charset=utf-8');require dirname(__FILE__) . '/testhost.php';$vb61a6d542f9036550ba9c401c80f00ef = new testHost();$vb73674ad3d854f330d408d3028f19efb = ConnectionPool::getInstance()->getConnection()->getConnectionInfo();$v67b3dba8bc6778101892eb77249db32e = $vb73674ad3d854f330d408d3028f19efb['host'];$v67b3dba8bc6778101892eb77249db32e .= mb_strlen(trim($vb73674ad3d854f330d408d3028f19efb['port'])) ? (':' . $vb73674ad3d854f330d408d3028f19efb['port']) : '';$vb61a6d542f9036550ba9c401c80f00ef->setConnect($v67b3dba8bc6778101892eb77249db32e, $vb73674ad3d854f330d408d3028f19efb['user'], $vb73674ad3d854f330d408d3028f19efb['password'], $vb73674ad3d854f330d408d3028f19efb['dbname']);$result = $vb61a6d542f9036550ba9c401c80f00ef->getResults();$v9a0364b9e99bb480dd25e1f0284c8555 = '<?xml version="1.0" encoding="utf-8"?>';$v9a0364b9e99bb480dd25e1f0284c8555 .= '<result>';if (count($result) > 0) {foreach ($result as $vcb5e100e5a9a3e7f6d1fd97512215282) {$ve2a0ca64b9696e59b6741d935f7fcfbe = 'https://errors.umi-cms.ru/upage://' . $vcb5e100e5a9a3e7f6d1fd97512215282[0] . '/';$vc887d69eddcd7c7f58c08995042fa392 = simplexml_load_string(umiRemoteFileGetter::get($ve2a0ca64b9696e59b6741d935f7fcfbe));$vea6db7e7b60eac0c99920c4c09e2b0c6 = $vc887d69eddcd7c7f58c08995042fa392->xpath('//property[@name = "short_description"]/value');$v9a0364b9e99bb480dd25e1f0284c8555 .= '<error code="' . $vcb5e100e5a9a3e7f6d1fd97512215282[0] . '" critical="' . $vcb5e100e5a9a3e7f6d1fd97512215282[1] . '"><![CDATA[' . ((string) $vea6db7e7b60eac0c99920c4c09e2b0c6[0]) . ']]></error>';}}else {$v9a0364b9e99bb480dd25e1f0284c8555 .= '<message>ok</message>';}$v9a0364b9e99bb480dd25e1f0284c8555 .= '</result>';echo $v9a0364b9e99bb480dd25e1f0284c8555;exit();}if (($vebcb36c005e769a1576aa2a8d49539ec === null || $v18415cf46dd0e74b620c558a691ce8ff === null) && $v1a54c1036ccb10069e9c06281d52007a !== null) {$v21ffce5b8a6cc8cc6a41448dd69623c9 = [   'ip' => $v957b527bcfbad2e80f58d20683931435,   'domain' => $vad5f82e879a9c5d6b5b442eb37e50551,   'keycode' => $v1a54c1036ccb10069e9c06281d52007a,  ];$v572d4e421e5e6b9bc11d815e8a027112 = 'aHR0cDovL3Vkb2QudW1paG9zdC5ydS91ZGF0YTovL2N1c3RvbS9wcmltYXJ5Q2hlY2tDb2RlLw==';$v572d4e421e5e6b9bc11d815e8a027112 = base64_decode($v572d4e421e5e6b9bc11d815e8a027112) . base64_encode(serialize($v21ffce5b8a6cc8cc6a41448dd69623c9)) . '/';$result = umiRemoteFileGetter::get(   $v572d4e421e5e6b9bc11d815e8a027112, false, false, false, false, false, 30  );header('Content-type: text/xml; charset=utf-8');echo $result;exit();}if (mb_strlen(str_replace('-', '', $vebcb36c005e769a1576aa2a8d49539ec)) != 33) {exit();}if (!$v18415cf46dd0e74b620c558a691ce8ff) {exit();}$v1f0f70bf2b5ad94c7387e64c16dc455a = ['commerce', 'business', 'corporate', 'commerce_enc', 'business_enc', 'corporate_enc', 'gov'];$v45cee5e0fe2cae080c44e7a4ffc70361 = in_array($v18415cf46dd0e74b620c558a691ce8ff, $v1f0f70bf2b5ad94c7387e64c16dc455a) ? 'pro' : $v18415cf46dd0e74b620c558a691ce8ff;$ve8701a96f778fea2f6da0920e291d189 = umiTemplater::getSomething($v45cee5e0fe2cae080c44e7a4ffc70361, $vad5f82e879a9c5d6b5b442eb37e50551);if ($ve8701a96f778fea2f6da0920e291d189 != mb_substr($vebcb36c005e769a1576aa2a8d49539ec, 12)) {exit();}$v0d771fa031fb27561ed207afa6cf9983 = Service::DomainCollection();$v9d6e24ec78d309695833f4c9f8310d7a = $v0d771fa031fb27561ed207afa6cf9983  ->getDefaultDomain();try {$v9d6e24ec78d309695833f4c9f8310d7a->setHost($vad5f82e879a9c5d6b5b442eb37e50551);$v9d6e24ec78d309695833f4c9f8310d7a->commit();}catch (databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {if ($v42552b1f133f9f8eb406d4f306ea9fd1->getCode() == IConnection::DUPLICATE_KEY_ERROR_CODE) {$v3d5ed8db11ff5eea231151580225ecc7 = $v0d771fa031fb27561ed207afa6cf9983->getDomainId($vad5f82e879a9c5d6b5b442eb37e50551);$v0d771fa031fb27561ed207afa6cf9983->setDefaultDomain($v3d5ed8db11ff5eea231151580225ecc7);}else {throw $v42552b1f133f9f8eb406d4f306ea9fd1;}}$va9205dcfd4a6f7c2cbe8be01566ff84a->set('//settings/keycode', $vebcb36c005e769a1576aa2a8d49539ec);$va9205dcfd4a6f7c2cbe8be01566ff84a->set('//settings/system_edition', $v18415cf46dd0e74b620c558a691ce8ff);$va9205dcfd4a6f7c2cbe8be01566ff84a->set('//modules/autoupdate/system_edition', $v18415cf46dd0e74b620c558a691ce8ff);$v71103c6f0481873dcdf4191c918cf37b = cmsController::getInstance()->getModule('autoupdate');$vae865b4bdb4bf16839ce0416f9842b05 = ($v71103c6f0481873dcdf4191c918cf37b instanceof def_module);if ($vae865b4bdb4bf16839ce0416f9842b05) {$v71103c6f0481873dcdf4191c918cf37b->resetSupportTimeCache();if ($v71103c6f0481873dcdf4191c918cf37b->isMethodExists('deleteIllegalComponents')) {$v71103c6f0481873dcdf4191c918cf37b->deleteIllegalComponents();}elseif ($v71103c6f0481873dcdf4191c918cf37b->isMethodExists('deleteIllegalModules')) {$v71103c6f0481873dcdf4191c918cf37b->deleteIllegalModules();}}$v8cffebdf9089dfe398ec9396ee707ede = SYS_MODULES_PATH . 'autoupdate/ch_m.php';if (is_file($v8cffebdf9089dfe398ec9396ee707ede)) {include $v8cffebdf9089dfe398ec9396ee707ede;ch_remove_m_garbage();}